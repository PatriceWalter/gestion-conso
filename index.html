<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Tourn√©es</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0f1e;
            color: #f8fafc;
            min-height: 100vh;
        }

        /* Navigation */
        .nav {
            background: #131b2e;
            border-bottom: 2px solid #334155;
            padding: 0 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 20px 0;
        }

        .nav-btn {
            padding: 20px 25px;
            background: none;
            border: none;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
        }

        .nav-btn.active {
            color: #0ea5e9;
            border-bottom-color: #0ea5e9;
        }

        .admin-btn {
            margin-left: auto;
            padding: 10px 15px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            color: #f59e0b;
            transform: scale(1.1);
        }

        /* Pages */
        .page {
            display: none;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page.active {
            display: block;
        }

        /* S√©lection type */
        .type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 60px;
        }

        .type-card {
            background: #131b2e;
            border: 3px solid #334155;
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-card:hover {
            border-color: #0ea5e9;
            transform: translateY(-5px);
        }

        .schedule-card {
            background: #131b2e;
            border: 3px solid #334155;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .schedule-card:hover {
            border-color: #0ea5e9;
            transform: translateY(-3px);
        }

        .schedule-card.selected {
            border-color: #10b981;
            background: linear-gradient(135deg, #131b2e, #0a2818);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .type-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .type-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        /* Grille */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .card {
            background: #131b2e;
            border: 2px solid #334155;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #0ea5e9;
            transform: translateY(-3px);
        }

        .card-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card-label {
            color: #94a3b8;
            margin-top: 10px;
        }

        .poste-status-card {
            background: #131b2e;
            border: 3px solid #334155;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .poste-status-card.has-order {
            border-color: #10b981;
            background: linear-gradient(135deg, #131b2e, #0a2818);
        }

        .poste-status-card.no-order {
            border-color: #ef4444;
            background: linear-gradient(135deg, #131b2e, #2a0a0a);
        }

        .poste-status-card.paid {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #131b2e, #0a1a2e);
        }

        .poste-status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.3);
        }

        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .status-badge.green {
            background: #10b981;
        }

        .status-badge.red {
            background: #ef4444;
        }

        .status-badge.blue {
            background: #3b82f6;
        }

        .paid-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5rem;
        }

        /* Products */
        .products-section {
            background: #131b2e;
            border: 2px solid #334155;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 20px;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .product-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .product-price {
            color: #10b981;
            font-weight: 700;
        }

        .qty-control {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            background: #0a0f1e;
            border: 2px solid #334155;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .qty-display {
            flex: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            padding: 8px;
            background: #0a0f1e;
            border-radius: 8px;
        }

        .sauces-box {
            display: none;
            background: #0a0f1e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .sauces-box.show {
            display: block;
        }

        .sauces-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #94a3b8;
        }

        .sauces-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .sauce-btn {
            padding: 6px 12px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            color: #94a3b8;
        }

        .sauce-btn.selected {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .validate-sandwich-btn {
            width: 100%;
            padding: 12px;
            background: #10b981;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* R√©capitulatif */
        .summary-float {
            position: fixed;
            right: 30px;
            bottom: 30px;
            background: #131b2e;
            border: 3px solid #0ea5e9;
            border-radius: 20px;
            padding: 25px;
            min-width: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        .summary-title {
            font-weight: 700;
            margin-bottom: 15px;
        }

        .summary-items {
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-top: 2px solid #334155;
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 10px;
        }

        .validate-order-btn {
            width: 100%;
            padding: 15px;
            background: #10b981;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            margin-top: 15px;
        }

        .validate-order-btn:disabled {
            background: #334155;
            cursor: not-allowed;
        }

        /* Pr√©paration */
        .prep-grid {
            display: grid;
            gap: 20px;
        }

        .prep-card {
            background: #131b2e;
            border: 2px solid #334155;
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .edit-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: #0ea5e9;
            border: none;
            border-radius: 8px;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .prep-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #334155;
            padding-right: 80px;
        }

        .prep-poste {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0ea5e9;
        }

        .prep-items {
            display: grid;
            gap: 10px;
        }

        .prep-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #1e293b;
            border-radius: 8px;
        }

        .item-sauces {
            font-size: 0.85rem;
            color: #f59e0b;
            margin-top: 4px;
        }

        .prep-total {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #334155;
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* Total g√©n√©ral */
        .total-grid {
            display: grid;
            gap: 20px;
        }

        .total-card {
            background: #131b2e;
            border: 2px solid #334155;
            border-radius: 15px;
            padding: 25px;
        }

        .total-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #334155;
        }

        .total-schedule {
            background: #0ea5e9;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .total-items {
            display: grid;
            gap: 10px;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #1e293b;
            border-radius: 8px;
        }

        .total-grand {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 3px solid #0ea5e9;
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .notif {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            background: #10b981;
            color: white;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.5s;
        }

        .notif.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .type-grid {
                grid-template-columns: 1fr;
            }
            .summary-float {
                position: static;
                margin-top: 30px;
            }
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-logo">üöö Gestion Tourn√©es</div>
        <button class="nav-btn active" onclick="goToPage('home')">üè† Accueil</button>
        <button class="nav-btn" onclick="goToPage('preparation')">üìã √Ä Pr√©parer</button>
        <button class="nav-btn" onclick="goToPage('served')">‚úÖ Commandes Servies</button>
        <button class="nav-btn" onclick="goToPage('total')">üìä Commandes</button>
        <button class="admin-btn" onclick="openAdminLogin()">‚öôÔ∏è</button>
    </nav>

    <!-- Modal Login Admin -->
    <div id="adminLoginModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 3000; align-items: center; justify-content: center;">
        <div style="background: #131b2e; border: 3px solid #f59e0b; border-radius: 20px; padding: 50px; max-width: 500px; width: 90%; text-align: center;">
            <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: #f59e0b;">üîí Acc√®s Admin</h2>
            <p style="color: #94a3b8; margin-bottom: 30px; font-size: 1.1rem;">Code d'acc√®s requis</p>
            <input type="password" id="adminPasswordInput" placeholder="Entrez le code" style="width: 100%; padding: 20px; background: #1e293b; border: 3px solid #334155; border-radius: 12px; color: white; font-size: 1.3rem; text-align: center; margin-bottom: 30px; font-family: 'Inter', sans-serif;" onkeypress="if(event.key==='Enter') checkAdminPassword()">
            <div style="display: flex; gap: 15px;">
                <button onclick="checkAdminPassword()" style="flex: 1; padding: 18px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.2rem;">
                    ‚úÖ Valider
                </button>
                <button onclick="closeAdminLogin()" style="flex: 1; padding: 18px; background: #ef4444; border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.2rem;">
                    ‚ùå Annuler
                </button>
            </div>
            <div id="adminError" style="color: #ef4444; margin-top: 20px; font-weight: 600; display: none;"></div>
        </div>
    </div>

    <!-- Modal Admin -->
    <div id="adminModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: #131b2e; border: 3px solid #f59e0b; border-radius: 20px; padding: 30px; max-width: 700px; width: 95%; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="font-size: 1.5rem; margin: 0; color: #f59e0b;">‚öôÔ∏è Administration</h2>
                <button onclick="closeAdminPanel()" style="background: #ef4444; border: none; border-radius: 8px; color: white; padding: 8px 16px; cursor: pointer; font-weight: 600;">‚úï Fermer</button>
            </div>
            <div id="adminContent"></div>
        </div>
    </div>

    <!-- Page 1: Accueil - Choix Horaire et Type -->
    <div id="home" class="page active">
        <h1>S√©lectionnez l'horaire de tourn√©e</h1>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 60px;">
            <div class="schedule-card" data-schedule="9h" onclick="selectScheduleHome('9h')">
                <div style="font-size: 3rem; margin-bottom: 10px;">üåÖ</div>
                <div style="font-size: 1.5rem; font-weight: 700;">9h</div>
            </div>
            <div class="schedule-card" data-schedule="10h30" onclick="selectScheduleHome('10h30')">
                <div style="font-size: 3rem; margin-bottom: 10px;">‚òÄÔ∏è</div>
                <div style="font-size: 1.5rem; font-weight: 700;">10h30</div>
            </div>
            <div class="schedule-card" data-schedule="15h" onclick="selectScheduleHome('15h')">
                <div style="font-size: 3rem; margin-bottom: 10px;">üå§Ô∏è</div>
                <div style="font-size: 1.5rem; font-weight: 700;">15h</div>
            </div>
            <div class="schedule-card" data-schedule="16h30" onclick="selectScheduleHome('16h30')">
                <div style="font-size: 3rem; margin-bottom: 10px;">üåÜ</div>
                <div style="font-size: 1.5rem; font-weight: 700;">16h30</div>
            </div>
        </div>
        
        <h1 style="margin-top: 40px;">S√©lectionnez le type de poste</h1>
        <div class="type-grid">
            <div class="type-card" onclick="selectType('carpodrome')">
                <div class="type-icon">üêü</div>
                <div class="type-title">Carpodrome</div>
                <p style="color: #94a3b8;">14 postes disponibles</p>
            </div>
            <div class="type-card" onclick="selectType('feeder')">
                <div class="type-icon">üé£</div>
                <div class="type-title">Feeder</div>
                <p style="color: #94a3b8;">10 postes disponibles</p>
            </div>
        </div>
    </div>

    <!-- Page 2: S√©lection Horaire -->
    <div id="schedule-select" class="page">
        <h1 id="scheduleTitle"></h1>
        <div class="grid" id="scheduleGrid"></div>
    </div>

    <!-- Page 3: S√©lection Poste -->
    <div id="poste-select" class="page">
        <h1 id="posteTitle"></h1>
        <div class="grid" id="postesGrid"></div>
    </div>

    <!-- Page 4: Commande Produits -->
    <div id="products" class="page">
        <h1 id="productsTitle"></h1>

        <div class="products-section">
            <h2 class="section-title">ü•§ Boissons</h2>
            <div id="drinksGrid" class="products-grid"></div>
        </div>

        <div class="products-section">
            <h2 class="section-title">ü•™ Sandwichs</h2>
            <div id="sandwichsGrid" class="products-grid"></div>
        </div>

        <div class="products-section">
            <h2 class="section-title">üçü Accompagnement</h2>
            <div id="sidesGrid" class="products-grid"></div>
        </div>

        <div class="summary-float">
            <h3 class="summary-title">üìù R√©capitulatif</h3>
            <div id="summaryItems" class="summary-items"></div>
            <div class="summary-total">
                <span>Total</span>
                <span id="summaryTotal">0.00 ‚Ç¨</span>
            </div>
            <button id="validateOrderBtn" class="validate-order-btn" onclick="validateOrder()">
                ‚úÖ Valider la commande
            </button>
        </div>
    </div>

    <!-- Page 5: √Ä Pr√©parer -->
    <div id="preparation" class="page">
        <h1>üìã Commandes √† Pr√©parer</h1>
        <div id="prepGrid" class="prep-grid"></div>
    </div>

    <!-- Page 6: Commandes Servies -->
    <div id="served" class="page">
        <h1>‚úÖ Commandes Servies</h1>
        <div id="servedGrid" class="prep-grid"></div>
    </div>

    <!-- Page 7: Commandes -->
    <div id="total" class="page">
        <h1>üìä Commandes</h1>
        
        <!-- Boutons Type -->
        <div style="display: flex; gap: 20px; margin-bottom: 30px;">
            <button onclick="showTotalType('carpodrome')" style="flex: 1; padding: 20px 30px; background: linear-gradient(135deg, #0ea5e9, #0284c7); border: 4px solid white; border-radius: 15px; color: white; font-size: 1.3rem; font-weight: 700; cursor: pointer; font-family: 'Inter', sans-serif; box-shadow: 0 4px 20px rgba(14, 165, 233, 0.5);">
                üêü Carpodrome
            </button>
            <button onclick="showTotalType('feeder')" style="flex: 1; padding: 20px 30px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: 4px solid white; border-radius: 15px; color: white; font-size: 1.3rem; font-weight: 700; cursor: pointer; font-family: 'Inter', sans-serif; box-shadow: 0 4px 20px rgba(139, 92, 246, 0.5);">
                üé£ Feeder
            </button>
        </div>
        
        <!-- Section 1: Commandes restantes √† payer -->
        <div id="sectionRestantAPayer" style="margin-bottom: 40px;"></div>
        
        <!-- Section 2: Commandes pay√©es par carton -->
        <div id="sectionPayeesCarton" style="margin-bottom: 40px;"></div>
        
        <!-- Section 3: Total Commandes -->
        <div id="sectionTotalCommandes"></div>
    </div>

    <!-- Modal d√©tail poste -->
    <div id="posteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: #131b2e; border: 3px solid #0ea5e9; border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 id="modalTitle" style="font-size: 2rem; margin: 0;"></h2>
                <button onclick="closePosteModal()" style="background: #ef4444; border: none; border-radius: 8px; color: white; padding: 10px 20px; cursor: pointer; font-weight: 600;">‚úï Fermer</button>
            </div>
            <div id="modalContent"></div>
            <div style="margin-top: 30px; padding-top: 20px; border-top: 3px solid #0ea5e9;">
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 1.8rem; font-weight: 700; margin-bottom: 20px;">
                    <span>TOTAL √Ä PAYER</span>
                    <span id="modalTotal" style="color: #10b981;"></span>
                </div>
                <label style="display: flex; align-items: center; gap: 15px; cursor: pointer; background: #1e293b; padding: 20px; border-radius: 12px; border: 2px solid #334155;">
                    <input type="checkbox" id="paidCheckbox" onchange="togglePaid()" style="width: 30px; height: 30px; cursor: pointer; accent-color: #10b981;">
                    <span style="font-size: 1.2rem; font-weight: 600;">‚úÖ Commande pay√©e</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Modal Service -->
    <div id="serviceModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: #131b2e; border: 3px solid #10b981; border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 id="serviceModalTitle" style="font-size: 2rem; margin: 0;"></h2>
                <button onclick="closeServiceModal()" style="background: #ef4444; border: none; border-radius: 8px; color: white; padding: 10px 20px; cursor: pointer; font-weight: 600;">‚úï Fermer</button>
            </div>
            <div id="serviceModalContent"></div>
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBgfUBob6kuHiGEN6k8B1Z-Gl4pBd05R5s",
            authDomain: "gestion-conso.firebaseapp.com",
            databaseURL: "https://gestion-conso-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "gestion-conso",
            storageBucket: "gestion-conso.firebasestorage.app",
            messagingSenderId: "287764135076",
            appId: "1:287764135076:web:e1c685d1e9e99f4644ba31",
            measurementId: "G-8M9M60FEXN"
        };
        
        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Donn√©es
        const DATA = {
            products: [
                {name: "Bi√®re", price: 2.0, category: "drink"},
                {name: "Desp√©rados", price: 3.5, category: "drink"},
                {name: "Picon", price: 2.5, category: "drink"},
                {name: "Coca", price: 2.5, category: "drink"},
                {name: "Ice tea", price: 2.5, category: "drink"},
                {name: "Orangina", price: 2.5, category: "drink"},
                {name: "Eau plate", price: 2.5, category: "drink"},
                {name: "Eau gazeuse", price: 2.5, category: "drink"},
                {name: "Caf√©", price: 1.0, category: "drink"},
                {name: "Merguez", price: 3.5, category: "sandwich", sauces: "all"},
                {name: "Saucisse blanche", price: 3.5, category: "sandwich", sauces: "all"},
                {name: "Knack", price: 3.5, category: "sandwich", sauces: "moutarde"},
                {name: "Frites", price: 2.0, category: "side"}
            ],
            sauces: ["Moutarde forte", "Moutarde douce", "Ketchup", "Mayo", "Harissa"],
            schedules: ["9h", "10h30", "15h", "16h30"]
        };

        let APP = {
            currentType: null,
            currentSchedule: null,
            currentPoste: null,
            order: {},
            allOrders: [],
            editingOrderId: null
        };

        // Chargement depuis Firebase
        function loadOrders() {
            database.ref('orders').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    APP.allOrders = Object.values(data);
                } else {
                    APP.allOrders = [];
                }
                console.log('üì• Donn√©es charg√©es depuis Firebase:', APP.allOrders.length, 'commandes');
                
                // Rafra√Æchir l'affichage si on est sur une page qui montre les commandes
                const activePage = document.querySelector('.page.active');
                if (activePage) {
                    if (activePage.id === 'preparation') renderPreparation();
                    else if (activePage.id === 'served') renderServed();
                    else if (activePage.id === 'total') renderTotal();
                }
            });
        }

        // Sauvegarde vers Firebase
        function saveOrders() {
            const ordersObj = {};
            APP.allOrders.forEach(order => {
                ordersObj[order.id] = order;
            });
            database.ref('orders').set(ordersObj)
                .then(() => {
                    console.log('üíæ Donn√©es sauvegard√©es sur Firebase');
                })
                .catch((error) => {
                    console.error('‚ùå Erreur Firebase:', error);
                    showNotif('‚ùå Erreur de sauvegarde !', true);
                });
        }

        // Navigation
        function goToPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Activer le bon bouton de nav
            const navBtn = document.querySelector(`[onclick="goToPage('${page}')"]`);
            if (navBtn) navBtn.classList.add('active');
            
            if (page === 'preparation') {
                renderPreparation();
            } else if (page === 'served') {
                renderServed();
            } else if (page === 'total') {
                renderTotal();
            } else if (page === 'home') {
                resetWorkflow();
                // Restaurer visuellement l'horaire s√©lectionn√©
                if (APP.currentSchedule) {
                    setTimeout(() => {
                        document.querySelectorAll('.schedule-card').forEach(card => {
                            card.classList.remove('selected');
                        });
                        const selectedCard = document.querySelector(`[data-schedule="${APP.currentSchedule}"]`);
                        if (selectedCard) selectedCard.classList.add('selected');
                    }, 50);
                }
            }
        }

        function resetWorkflow() {
            APP.currentType = null;
            // NE PAS r√©initialiser APP.currentSchedule pour qu'il reste m√©moris√©
            APP.currentPoste = null;
            APP.order = {};
            APP.editingOrderId = null;
        }

        // √âtape 1: S√©lection type
        // S√©lection horaire sur la page d'accueil
        function selectScheduleHome(schedule) {
            console.log('Horaire s√©lectionn√©:', schedule);
            APP.currentSchedule = schedule;
            
            // Enlever selected de toutes les cartes
            document.querySelectorAll('.schedule-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Ajouter selected √† la carte cliqu√©e
            document.querySelector(`[data-schedule="${schedule}"]`).classList.add('selected');
        }

        function selectType(type) {
            // V√©rifier si un horaire est s√©lectionn√©
            if (!APP.currentSchedule) {
                showNotif('‚ö†Ô∏è S√©lectionnez d\'abord un horaire !', true);
                return;
            }
            
            APP.currentType = type;
            const icon = type === 'carpodrome' ? 'üêü' : 'üé£';
            const label = type === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            
            // ALLER DIRECTEMENT √† la s√©lection de poste (on saute la page horaire)
            const count = type === 'carpodrome' ? 14 : 10;
            document.getElementById('posteTitle').textContent = `${icon} ${label} - ${APP.currentSchedule} - S√©lectionnez le poste`;
            
            const grid = document.getElementById('postesGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => selectPoste(i);
                div.innerHTML = `
                    <div class="card-number">${i}</div>
                    <div class="card-label">${label} ${i}</div>
                `;
                grid.appendChild(div);
            }
            
            document.getElementById('home').classList.remove('active');
            document.getElementById('poste-select').classList.add('active');
        }

        // √âtape 2: S√©lection horaire
        function selectSchedule(schedule) {
            APP.currentSchedule = schedule;
            const icon = APP.currentType === 'carpodrome' ? 'üêü' : 'üé£';
            const label = APP.currentType === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            
            document.getElementById('posteTitle').textContent = `${icon} ${label} - ${schedule} - S√©lectionnez le poste`;
            
            const count = APP.currentType === 'carpodrome' ? 14 : 10;
            const grid = document.getElementById('postesGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => selectPoste(i);
                div.innerHTML = `
                    <div class="card-number">${i}</div>
                    <div class="card-label">${label} ${i}</div>
                `;
                grid.appendChild(div);
            }
            
            document.getElementById('schedule-select').classList.remove('active');
            document.getElementById('poste-select').classList.add('active');
        }

        // √âtape 3: S√©lection poste
        function selectPoste(num) {
            APP.currentPoste = num;
            APP.order = {};
            
            const icon = APP.currentType === 'carpodrome' ? 'üêü' : 'üé£';
            const label = APP.currentType === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            document.getElementById('productsTitle').textContent = `${icon} ${label} poste ${num} - ${APP.currentSchedule}`;
            
            renderProducts();
            updateSummary();
            
            document.getElementById('poste-select').classList.remove('active');
            document.getElementById('products').classList.add('active');
        }

        // Rendu produits
        function renderProducts() {
            const drinks = DATA.products.filter(p => p.category === 'drink');
            const sandwichs = DATA.products.filter(p => p.category === 'sandwich');
            const sides = DATA.products.filter(p => p.category === 'side');

            renderProductGrid('drinksGrid', drinks, false);
            renderProductGrid('sandwichsGrid', sandwichs, true);
            renderProductGrid('sidesGrid', sides, false);
        }

        function renderProductGrid(containerId, products, isSandwich) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            products.forEach((product, idx) => {
                const id = product.category + '_' + idx;
                
                const card = document.createElement('div');
                card.className = 'product-card';
                
                let saucesHtml = '';
                if (isSandwich) {
                    const availableSauces = product.sauces === 'moutarde' 
                        ? DATA.sauces.filter(s => s.includes('Moutarde'))
                        : DATA.sauces;
                    
                    saucesHtml = `
                        <div class="sauces-box" id="sauces_${id}">
                            <div class="sauces-title">üå∂Ô∏è Sauces</div>
                            <div class="sauces-grid" id="saucegrid_${id}">
                                ${availableSauces.map(s => `
                                    <button class="sauce-btn" onclick="toggleSauce('${id}', '${s}')">${s}</button>
                                `).join('')}
                            </div>
                            <button class="validate-sandwich-btn" onclick="addSandwich('${id}', '${product.name}', ${product.price})">
                                ‚úÖ Valider ce sandwich
                            </button>
                        </div>
                    `;
                }
                
                card.innerHTML = `
                    <div class="product-header">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${product.price.toFixed(2)} ‚Ç¨</div>
                    </div>
                    <div class="qty-control">
                        <button class="qty-btn" onclick="changeQty('${id}', '${product.name}', ${product.price}, ${isSandwich}, -1)">‚àí</button>
                        <div class="qty-display" id="qty_${id}">0</div>
                        <button class="qty-btn" onclick="changeQty('${id}', '${product.name}', ${product.price}, ${isSandwich}, 1)">+</button>
                    </div>
                    ${saucesHtml}
                `;
                
                container.appendChild(card);
            });
        }

        // Changement quantit√©
        function changeQty(id, name, price, isSandwich, delta) {
            if (!APP.order[id]) {
                APP.order[id] = {name, price, qty: 0, tempQty: 0, sauces: []};
            }
            
            if (isSandwich) {
                APP.order[id].tempQty = Math.max(0, APP.order[id].tempQty + delta);
                document.getElementById('qty_' + id).textContent = APP.order[id].tempQty;
                
                const saucesBox = document.getElementById('sauces_' + id);
                if (APP.order[id].tempQty > 0) {
                    saucesBox.classList.add('show');
                } else {
                    saucesBox.classList.remove('show');
                }
            } else {
                APP.order[id].qty = Math.max(0, APP.order[id].qty + delta);
                document.getElementById('qty_' + id).textContent = APP.order[id].qty;
                updateSummary();
            }
        }

        // Toggle sauce
        function toggleSauce(id, sauce) {
            if (!APP.order[id]) return;
            
            const idx = APP.order[id].sauces.indexOf(sauce);
            if (idx > -1) {
                APP.order[id].sauces.splice(idx, 1);
            } else {
                APP.order[id].sauces.push(sauce);
            }
            
            event.target.classList.toggle('selected');
        }

        // Ajouter sandwich
        function addSandwich(id, name, price) {
            if (!APP.order[id] || APP.order[id].tempQty === 0) {
                showNotif('‚ö†Ô∏è S√©lectionnez une quantit√© !', true);
                return;
            }
            
            if (APP.order[id].sauces.length === 0) {
                showNotif('‚ö†Ô∏è Choisissez au moins une sauce !', true);
                return;
            }
            
            // Cr√©er un ID unique bas√© sur le nom + sauces
            const saucesKey = APP.order[id].sauces.sort().join('_');
            const uniqueId = id + '_' + saucesKey;
            
            // Si cette combinaison existe d√©j√†, ajouter la quantit√©
            if (APP.order[uniqueId]) {
                APP.order[uniqueId].qty += APP.order[id].tempQty;
            } else {
                // Sinon cr√©er une nouvelle entr√©e
                APP.order[uniqueId] = {
                    name: name,
                    price: price,
                    qty: APP.order[id].tempQty,
                    tempQty: 0,
                    sauces: [...APP.order[id].sauces] // Copie du tableau
                };
            }
            
            // Reset la s√©lection temporaire
            APP.order[id].tempQty = 0;
            APP.order[id].sauces = [];
            
            document.getElementById('qty_' + id).textContent = 0;
            document.getElementById('sauces_' + id).classList.remove('show');
            
            // Reset sauces visuellement
            document.querySelectorAll('#saucegrid_' + id + ' .sauce-btn').forEach(b => {
                b.classList.remove('selected');
            });
            
            showNotif('‚úÖ Sandwich ajout√© !');
            updateSummary();
        }

        // Mise √† jour r√©capitulatif
        function updateSummary() {
            const container = document.getElementById('summaryItems');
            container.innerHTML = '';
            
            let total = 0;
            let hasItems = false;
            
            for (let id in APP.order) {
                const item = APP.order[id];
                if (item.qty > 0) {
                    hasItems = true;
                    const itemTotal = item.qty * item.price;
                    total += itemTotal;
                    
                    const div = document.createElement('div');
                    div.className = 'summary-item';
                    
                    let saucesText = '';
                    if (item.sauces && item.sauces.length > 0) {
                        saucesText = `<br><small style="color: #f59e0b;">üå∂Ô∏è ${item.sauces.join(', ')}</small>`;
                    }
                    
                    div.innerHTML = `
                        <span>${item.name} √ó${item.qty}${saucesText}</span>
                        <span>${itemTotal.toFixed(2)} ‚Ç¨</span>
                    `;
                    container.appendChild(div);
                }
            }
            
            if (!hasItems) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8;">Aucun article</p>';
            }
            
            document.getElementById('summaryTotal').textContent = total.toFixed(2) + ' ‚Ç¨';
        }

        // Validation commande
        function validateOrder() {
            const items = [];
            let total = 0;
            
            for (let id in APP.order) {
                const item = APP.order[id];
                if (item.qty > 0) {
                    items.push({
                        name: item.name,
                        qty: item.qty,
                        price: item.price,
                        sauces: item.sauces.join(', '),
                        total: item.qty * item.price
                    });
                    total += item.qty * item.price;
                }
            }
            
            if (items.length === 0) {
                showNotif('‚ö†Ô∏è Ajoutez des produits !', true);
                return;
            }
            
            const label = APP.currentType === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            
            if (APP.editingOrderId !== null) {
                // Modifier la commande existante
                const idx = APP.allOrders.findIndex(o => o.id === APP.editingOrderId);
                if (idx > -1) {
                    APP.allOrders[idx].items = items;
                    APP.allOrders[idx].total = total;
                    showNotif('‚úÖ Commande modifi√©e !');
                }
                APP.editingOrderId = null;
            } else {
                // Nouvelle commande
                const order = {
                    id: Date.now(),
                    type: APP.currentType,
                    poste: APP.currentPoste,
                    label: label,
                    schedule: APP.currentSchedule,
                    items: items,
                    total: total,
                    date: new Date().toLocaleString('fr-FR')
                };
                
                APP.allOrders.push(order);
                showNotif('‚úÖ Commande valid√©e !');
            }
            
            saveOrders();
            
            setTimeout(() => {
                goToPage('home');
                resetWorkflow();
            }, 1000);
        }

        // Modifier une commande
        function editOrder(orderId) {
            const order = APP.allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            APP.editingOrderId = orderId;
            APP.currentType = order.type;
            APP.currentSchedule = order.schedule;
            APP.currentPoste = order.poste;
            
            // Reconstruire l'order
            APP.order = {};
            order.items.forEach(item => {
                // Trouver le product
                const product = DATA.products.find(p => p.name === item.name);
                if (product) {
                    const idx = DATA.products.indexOf(product);
                    const id = product.category + '_' + idx;
                    APP.order[id] = {
                        name: item.name,
                        price: item.price,
                        qty: item.qty,
                        tempQty: 0,
                        sauces: item.sauces ? item.sauces.split(', ').filter(s => s) : []
                    };
                }
            });
            
            const icon = order.type === 'carpodrome' ? 'üêü' : 'üé£';
            document.getElementById('productsTitle').textContent = `${icon} ${order.label} poste ${order.poste} - ${order.schedule} (Modification)`;
            
            renderProducts();
            updateSummary();
            
            document.getElementById('preparation').classList.remove('active');
            document.getElementById('products').classList.add('active');
        }

        // Rendu pr√©paration
        function renderPreparation() {
            const container = document.getElementById('prepGrid');
            
            // Filtrer les commandes non servies
            const unservedOrders = APP.allOrders.filter(o => !o.served);
            
            if (unservedOrders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 100px; color: #94a3b8;">
                        <div style="font-size: 5rem; margin-bottom: 20px;">üìã</div>
                        <h2>Aucune commande √† pr√©parer</h2>
                    </div>
                `;
                return;
            }
            
            // CALCULER LE TOTAL DE TOUS LES PRODUITS (en diff√©renciant les sauces)
            const productTotals = {};
            unservedOrders.forEach(order => {
                order.items.forEach(item => {
                    // Cr√©er une cl√© unique : nom + sauces
                    let key = item.name;
                    if (item.sauces && item.sauces.trim()) {
                        key = item.name + ' (' + item.sauces + ')';
                    }
                    
                    if (!productTotals[key]) {
                        productTotals[key] = 0;
                    }
                    productTotals[key] += item.qty;
                });
            });
            
            // CR√âER L'ENCADR√â R√âCAPITULATIF
            let summaryHtml = `
                <div style="background: linear-gradient(135deg, #0ea5e9, #8b5cf6); border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: 0 8px 30px rgba(14, 165, 233, 0.3);">
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: white; display: flex; align-items: center; gap: 10px;">
                        üì¶ <span>TOTAL √Ä PR√âPARER</span>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
            `;
            
            Object.entries(productTotals).sort((a, b) => b[1] - a[1]).forEach(([name, qty]) => {
                summaryHtml += `
                    <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 15px 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 2px solid rgba(255,255,255,0.2);">
                        <span style="font-weight: 600; color: white; font-size: 1.1rem;">${name}</span>
                        <span style="background: white; color: #0ea5e9; padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 1.2rem;">√ó${qty}</span>
                    </div>
                `;
            });
            
            summaryHtml += `
                    </div>
                </div>
            `;
            
            container.innerHTML = summaryHtml + unservedOrders.map(order => {
                const icon = order.type === 'carpodrome' ? 'üêü' : 'üé£';
                
                return `
                    <div class="prep-card" style="cursor: pointer; transition: all 0.3s;" onclick="showServiceModal(${order.id})" onmouseover="this.style.borderColor='#10b981'" onmouseout="this.style.borderColor='#334155'">
                        <div style="position: absolute; top: 25px; right: 25px; display: flex; gap: 10px; z-index: 10;">
                            <button onclick="event.stopPropagation(); deleteOrder(${order.id})" style="background: #ef4444; border: none; border-radius: 8px; color: white; padding: 8px 15px; cursor: pointer; font-weight: 600;">
                                üóëÔ∏è Supprimer
                            </button>
                            <button onclick="event.stopPropagation(); editOrder(${order.id})" style="background: #0ea5e9; border: none; border-radius: 8px; color: white; padding: 8px 15px; cursor: pointer; font-weight: 600;">
                                ‚úèÔ∏è Modifier
                            </button>
                        </div>
                        <div class="prep-header" style="padding-right: 220px;">
                            <div>
                                <div class="prep-poste">${icon} ${order.label} poste ${order.poste}</div>
                                <div style="color: #94a3b8; margin-top: 5px;">
                                    Horaire : <strong style="color: #0ea5e9;">${order.schedule}</strong>
                                </div>
                            </div>
                            <div style="color: #94a3b8;">${order.date}</div>
                        </div>
                        <div class="prep-items">
                            ${order.items.map(item => `
                                <div class="prep-item">
                                    <div>
                                        <div style="font-weight: 600;">${item.name}</div>
                                        ${item.sauces ? `<div class="item-sauces">üå∂Ô∏è ${item.sauces}</div>` : ''}
                                    </div>
                                    <div style="font-weight: 700; font-size: 1.2rem;">√ó${item.qty}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="prep-total">
                            <span>Total</span>
                            <span style="color: #10b981;">${order.total.toFixed(2)} ‚Ç¨</span>
                        </div>
                        <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 2px dashed #334155; color: #10b981; font-weight: 600;">
                            üëÜ Cliquez pour marquer comme SERVI
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteOrder(orderId) {
            // Demander le code via le modal admin login
            window.deleteOrderPending = orderId;
            openAdminLoginForDelete();
        }
        
        function openAdminLoginForDelete() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminPasswordInput').value = '';
            document.getElementById('adminPasswordInput').focus();
            document.getElementById('adminError').style.display = 'none';
            window.adminActionType = 'delete';
        }
        
        function executeDeleteOrder(orderId) {
            const order = APP.allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            console.log('Suppression commande:', orderId);
            APP.allOrders = APP.allOrders.filter(o => o.id !== orderId);
            saveOrders();
            
            showNotif('üóëÔ∏è Commande supprim√©e');
            renderPreparation();
        }

        // Rendu total par poste
        let currentTotalType = null;
        let currentModalPoste = null;
        let currentServiceOrderId = null;

        // Modal Service
        function showServiceModal(orderId) {
            currentServiceOrderId = orderId;
            window.selectedPaymentType = null; // Reset
            const order = APP.allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            const icon = order.type === 'carpodrome' ? 'üêü' : 'üé£';
            document.getElementById('serviceModalTitle').textContent = `${icon} ${order.label} poste ${order.poste} - ${order.schedule}`;
            
            let contentHtml = `
                <div style="background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #0ea5e9;">üì¶ Articles √† servir :</h3>
                    <div style="display: grid; gap: 10px;">
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: #0a0f1e; border-radius: 8px; border: 2px solid #334155;">
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1rem;">${item.name}</div>
                                    ${item.sauces ? `<div style="font-size: 0.85rem; color: #f59e0b; margin-top: 4px;">üå∂Ô∏è ${item.sauces}</div>` : ''}
                                </div>
                                <div style="font-weight: 700; font-size: 1.3rem; color: #10b981;">√ó${item.qty}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div style="background: #10b981; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: white;">
                        Total : ${order.total.toFixed(2)} ‚Ç¨
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #f59e0b; text-align: center;">üí∞ Mode de paiement :</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button id="btnPayCarton" onclick="selectPayment('carton')" style="padding: 20px; background: #1e293b; border: 3px solid #334155; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem; transition: all 0.3s;">
                            üí≥ Paiement CARTON
                        </button>
                        <button id="btnPayFin" onclick="selectPayment('fin_journee')" style="padding: 20px; background: #1e293b; border: 3px solid #334155; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem; transition: all 0.3s;">
                            ‚è∞ Paiement FIN DE JOURN√âE
                        </button>
                    </div>
                </div>
                
                <div id="serviceButtons" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button onclick="markAsServed()" style="padding: 18px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem;">
                            ‚úÖ Marquer comme SERVI
                        </button>
                        <button onclick="closeServiceModal()" style="padding: 18px; background: #ef4444; border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem;">
                            ‚ùå Annuler
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('serviceModalContent').innerHTML = contentHtml;
            document.getElementById('serviceModal').style.display = 'flex';
        }
        
        function selectPayment(type) {
            window.selectedPaymentType = type;
            
            // Reset styles
            document.getElementById('btnPayCarton').style.borderColor = '#334155';
            document.getElementById('btnPayCarton').style.background = '#1e293b';
            document.getElementById('btnPayFin').style.borderColor = '#334155';
            document.getElementById('btnPayFin').style.background = '#1e293b';
            
            // Highlight selected
            if (type === 'carton') {
                document.getElementById('btnPayCarton').style.borderColor = '#10b981';
                document.getElementById('btnPayCarton').style.background = 'linear-gradient(135deg, #0a2818, #1e293b)';
            } else {
                document.getElementById('btnPayFin').style.borderColor = '#f59e0b';
                document.getElementById('btnPayFin').style.background = 'linear-gradient(135deg, #2a1a00, #1e293b)';
            }
            
            // Show action buttons
            document.getElementById('serviceButtons').style.display = 'block';
        }

        function closeServiceModal() {
            document.getElementById('serviceModal').style.display = 'none';
            currentServiceOrderId = null;
            window.selectedPaymentType = null;
        }

        function markAsServed() {
            if (!currentServiceOrderId) return;
            if (!window.selectedPaymentType) {
                showNotif('‚ö†Ô∏è Choisissez un mode de paiement !', true);
                return;
            }
            
            const order = APP.allOrders.find(o => o.id === currentServiceOrderId);
            if (order) {
                order.served = true;
                order.servedDate = new Date().toLocaleString('fr-FR');
                order.paymentType = window.selectedPaymentType; // 'carton' ou 'fin_journee'
                saveOrders();
                
                if (window.selectedPaymentType === 'carton') {
                    showNotif('‚úÖ Commande SERVIE - Pay√©e par CARTON');
                } else {
                    showNotif('‚úÖ Commande SERVIE - Paiement FIN DE JOURN√âE');
                }
                closeServiceModal();
                renderPreparation();
            }
        }

        // Rendu commandes servies
        function renderServed() {
            const container = document.getElementById('servedGrid');
            
            // Filtrer les commandes servies
            const servedOrders = APP.allOrders.filter(o => o.served);
            
            if (servedOrders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 100px; color: #94a3b8;">
                        <div style="font-size: 5rem; margin-bottom: 20px;">‚úÖ</div>
                        <h2>Aucune commande servie</h2>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            servedOrders.forEach(order => {
                const icon = order.type === 'carpodrome' ? 'üêü' : 'üé£';
                
                const card = document.createElement('div');
                card.className = 'prep-card';
                card.style.borderColor = '#10b981';
                card.style.background = 'linear-gradient(135deg, #131b2e, #0a2818)';
                card.style.position = 'relative';
                
                // D'ABORD cr√©er le contenu HTML
                card.innerHTML = `
                    <div class="prep-header" style="padding-right: 220px;">
                        <div>
                            <div class="prep-poste">${icon} ${order.label} poste ${order.poste}</div>
                            <div style="color: #94a3b8; margin-top: 5px;">
                                Horaire : <strong style="color: #0ea5e9;">${order.schedule}</strong>
                            </div>
                            <div style="color: #10b981; margin-top: 5px; font-size: 0.9rem;">
                                Servi le : ${order.servedDate || order.date}
                            </div>
                        </div>
                    </div>
                    <div class="prep-items">
                        ${order.items.map(item => `
                            <div class="prep-item">
                                <div>
                                    <div style="font-weight: 600;">${item.name}</div>
                                    ${item.sauces ? `<div class="item-sauces">üå∂Ô∏è ${item.sauces}</div>` : ''}
                                </div>
                                <div style="font-weight: 700; font-size: 1.2rem;">√ó${item.qty}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="prep-total">
                        <span>Total</span>
                        <span style="color: #10b981;">${order.total.toFixed(2)} ‚Ç¨</span>
                    </div>
                `;
                
                // ENSUITE cr√©er le bouton avec onclick
                const btnDiv = document.createElement('div');
                btnDiv.style.cssText = 'position: absolute; top: 25px; right: 25px; display: flex; gap: 10px; z-index: 10;';
                
                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'üîÑ Annuler';
                cancelBtn.style.cssText = 'background: #f59e0b; border: none; border-radius: 8px; color: white; padding: 8px 15px; cursor: pointer; font-weight: 600;';
                cancelBtn.onclick = function(e) {
                    e.stopPropagation();
                    const orderId = order.id;
                    console.log('=== BOUTON ANNULER CLIQU√â ===');
                    console.log('Order ID:', orderId);
                    console.log('APP.allOrders AVANT:', JSON.parse(JSON.stringify(APP.allOrders)));
                    
                    // PAS DE CONFIRM - ACTION DIRECTE
                    const realOrder = APP.allOrders.find(o => o.id === orderId);
                    console.log('Real order trouv√©:', realOrder);
                    
                    if (realOrder) {
                        realOrder.served = false;
                        delete realOrder.servedDate;
                        console.log('APP.allOrders APR√àS modification:', JSON.parse(JSON.stringify(APP.allOrders)));
                        
                        saveOrders();
                        console.log('saveOrders() appel√©');
                        
                        showNotif('üîÑ Commande remise dans "√Ä Pr√©parer"');
                        console.log('Avant goToPage(preparation)');
                        
                        // Rediriger vers √Ä Pr√©parer pour voir la commande
                        goToPage('preparation');
                        console.log('Apr√®s goToPage(preparation)');
                    } else {
                        console.error('Order not found!', orderId);
                    }
                };
                
                const badge = document.createElement('div');
                badge.textContent = '‚úÖ SERVI';
                badge.style.cssText = 'background: #10b981; padding: 8px 15px; border-radius: 8px; font-weight: 600;';
                
                btnDiv.appendChild(cancelBtn);
                btnDiv.appendChild(badge);
                
                // Ajouter le bouton AU D√âBUT de la carte
                card.insertBefore(btnDiv, card.firstChild);
                container.appendChild(card);
            });
        }

        function showTotalType(type) {
            currentTotalType = type;
            const count = type === 'carpodrome' ? 14 : 10;
            const icon = type === 'carpodrome' ? 'üêü' : 'üé£';
            const label = type === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            
            // Filtrer les commandes servies par type
            const servedOrders = APP.allOrders.filter(o => o.served && o.type === type);
            
            // Section 1: COMMANDES RESTANTES √Ä PAYER (fin de journ√©e, pas encore pay√©es)
            const ordersFinJournee = servedOrders.filter(o => o.paymentType === 'fin_journee' && !o.paid);
            let section1Html = '';
            
            if (ordersFinJournee.length > 0) {
                let totalRestant = 0;
                section1Html = `
                    <div style="background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h2 style="color: white; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            üí∞ COMMANDES RESTANTES √Ä PAYER - ${label}
                        </h2>
                        <div style="display: grid; gap: 15px;">
                `;
                
                // Grouper par poste
                const byPoste = {};
                ordersFinJournee.forEach(order => {
                    if (!byPoste[order.poste]) byPoste[order.poste] = [];
                    byPoste[order.poste].push(order);
                });
                
                Object.keys(byPoste).sort((a,b) => a - b).forEach(poste => {
                    const orders = byPoste[poste];
                    let posteTotal = 0;
                    orders.forEach(o => posteTotal += o.total);
                    totalRestant += posteTotal;
                    
                    section1Html += `
                        <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 15px 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 700; font-size: 1.2rem; color: white;">${icon} Poste ${poste}</div>
                                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-top: 5px;">
                                        ${orders.map(o => o.schedule).join(', ')}
                                    </div>
                                </div>
                                <div style="background: white; color: #f59e0b; padding: 10px 20px; border-radius: 8px; font-weight: 700; font-size: 1.3rem;">
                                    ${posteTotal.toFixed(2)} ‚Ç¨
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                section1Html += `
                        </div>
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid rgba(255,255,255,0.3); display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: white; font-size: 1.3rem; font-weight: 700;">TOTAL √Ä ENCAISSER :</span>
                            <span style="background: white; color: #f59e0b; padding: 12px 25px; border-radius: 10px; font-weight: 800; font-size: 1.5rem;">${totalRestant.toFixed(2)} ‚Ç¨</span>
                        </div>
                    </div>
                `;
            }
            document.getElementById('sectionRestantAPayer').innerHTML = section1Html;
            
            // Section 2: COMMANDES PAY√âES PAR CARTON
            const ordersCarton = servedOrders.filter(o => o.paymentType === 'carton');
            let section2Html = '';
            
            if (ordersCarton.length > 0) {
                let totalCarton = 0;
                section2Html = `
                    <div style="background: linear-gradient(135deg, #10b981, #059669); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h2 style="color: white; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            üí≥ COMMANDES PAY√âES PAR CARTON - ${label}
                        </h2>
                        <div style="display: grid; gap: 15px;">
                `;
                
                // Grouper par poste
                const byPoste = {};
                ordersCarton.forEach(order => {
                    if (!byPoste[order.poste]) byPoste[order.poste] = [];
                    byPoste[order.poste].push(order);
                });
                
                Object.keys(byPoste).sort((a,b) => a - b).forEach(poste => {
                    const orders = byPoste[poste];
                    let posteTotal = 0;
                    orders.forEach(o => posteTotal += o.total);
                    totalCarton += posteTotal;
                    
                    section2Html += `
                        <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 15px 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 700; font-size: 1.2rem; color: white;">${icon} Poste ${poste}</div>
                                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-top: 5px;">
                                        ${orders.map(o => o.schedule).join(', ')}
                                    </div>
                                </div>
                                <div style="background: white; color: #10b981; padding: 10px 20px; border-radius: 8px; font-weight: 700; font-size: 1.3rem;">
                                    ${posteTotal.toFixed(2)} ‚Ç¨
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                section2Html += `
                        </div>
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid rgba(255,255,255,0.3); display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: white; font-size: 1.3rem; font-weight: 700;">TOTAL ENCAISS√â :</span>
                            <span style="background: white; color: #10b981; padding: 12px 25px; border-radius: 10px; font-weight: 800; font-size: 1.5rem;">${totalCarton.toFixed(2)} ‚Ç¨</span>
                        </div>
                    </div>
                `;
            }
            document.getElementById('sectionPayeesCarton').innerHTML = section2Html;
            
            // Section 3: TOTAL COMMANDES (par poste)
            let section3Html = `
                <div style="background: #131b2e; border: 3px solid #334155; border-radius: 15px; padding: 25px;">
                    <h2 style="color: #0ea5e9; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        üìä TOTAL COMMANDES - ${label}
                    </h2>
                    <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
            `;
            
            let grandTotal = 0;
            
            for (let i = 1; i <= count; i++) {
                const posteOrders = APP.allOrders.filter(o => o.type === type && o.poste === i && o.served);
                const hasOrders = posteOrders.length > 0;
                
                let totalPoste = 0;
                posteOrders.forEach(o => totalPoste += o.total);
                grandTotal += totalPoste;
                
                let bgColor = '#1e293b';
                let borderColor = '#334155';
                let statusText = 'Pas de commande';
                let statusColor = '#ef4444';
                
                if (hasOrders) {
                    statusText = totalPoste.toFixed(2) + ' ‚Ç¨';
                    statusColor = '#10b981';
                    borderColor = '#10b981';
                    bgColor = 'linear-gradient(135deg, #1e293b, #0a2818)';
                }
                
                section3Html += `
                    <div onclick="showPosteDetail('${type}', ${i})" style="background: ${bgColor}; border: 2px solid ${borderColor}; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                        <div style="font-size: 2rem; font-weight: 800; background: linear-gradient(135deg, #0ea5e9, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${i}</div>
                        <div style="color: #94a3b8; margin-top: 5px;">${label} ${i}</div>
                        <div style="color: ${statusColor}; font-weight: 700; margin-top: 10px;">${statusText}</div>
                    </div>
                `;
            }
            
            section3Html += `
                    </div>
                    <div style="margin-top: 25px; padding-top: 20px; border-top: 3px solid #334155; display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: white; font-size: 1.5rem; font-weight: 700;">TOTAL G√âN√âRAL ${label.toUpperCase()} :</span>
                        <span style="background: linear-gradient(135deg, #0ea5e9, #8b5cf6); color: white; padding: 15px 30px; border-radius: 12px; font-weight: 800; font-size: 1.8rem;">${grandTotal.toFixed(2)} ‚Ç¨</span>
                    </div>
                </div>
            `;
            
            document.getElementById('sectionTotalCommandes').innerHTML = section3Html;
        }

        function showPosteDetail(type, posteNum) {
            currentModalPoste = {type, posteNum};
            const posteOrders = APP.allOrders.filter(o => o.type === type && o.poste === posteNum);
            
            if (posteOrders.length === 0) {
                showNotif('‚ö†Ô∏è Aucune commande pour ce poste', true);
                return;
            }
            
            const icon = type === 'carpodrome' ? 'üêü' : 'üé£';
            const label = type === 'carpodrome' ? 'Carpodrome' : 'Feeder';
            
            document.getElementById('modalTitle').textContent = `${icon} ${label} poste ${posteNum}`;
            
            // Regrouper tous les items par produit
            const itemsByProduct = {};
            let grandTotal = 0;
            
            posteOrders.forEach(order => {
                grandTotal += order.total;
                order.items.forEach(item => {
                    const key = item.name + (item.sauces ? '|' + item.sauces : '');
                    if (!itemsByProduct[key]) {
                        itemsByProduct[key] = {
                            name: item.name,
                            sauces: item.sauces,
                            qty: 0,
                            price: item.price,
                            total: 0,
                            schedules: []
                        };
                    }
                    itemsByProduct[key].qty += item.qty;
                    itemsByProduct[key].total += item.total;
                    if (!itemsByProduct[key].schedules.includes(order.schedule)) {
                        itemsByProduct[key].schedules.push(order.schedule);
                    }
                });
            });
            
            // Afficher par horaire
            let contentHtml = '';
            
            const scheduleIcons = {'9h': 'üåÖ', '10h30': '‚òÄÔ∏è', '15h': 'üå§Ô∏è', '16h30': 'üåÜ'};
            
            posteOrders.forEach(order => {
                contentHtml += `
                    <div style="background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #334155;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="font-size: 1.3rem; font-weight: 700; color: #0ea5e9;">
                                ${scheduleIcons[order.schedule]} Tourn√©e ${order.schedule}
                            </div>
                            <div style="color: #94a3b8; font-size: 0.9rem;">${order.date}</div>
                        </div>
                        <div style="display: grid; gap: 10px;">
                            ${order.items.map(item => `
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: #0a0f1e; border-radius: 8px;">
                                    <div>
                                        <div style="font-weight: 600;">${item.name} √ó${item.qty}</div>
                                        ${item.sauces ? `<div style="font-size: 0.85rem; color: #f59e0b; margin-top: 4px;">üå∂Ô∏è ${item.sauces}</div>` : ''}
                                    </div>
                                    <div style="font-weight: 700; color: #10b981;">${item.total.toFixed(2)} ‚Ç¨</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="text-align: right; margin-top: 10px; padding-top: 10px; border-top: 1px solid #334155;">
                            <strong>Sous-total : ${order.total.toFixed(2)} ‚Ç¨</strong>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('modalContent').innerHTML = contentHtml;
            document.getElementById('modalTotal').textContent = grandTotal.toFixed(2) + ' ‚Ç¨';
            
            // Statut pay√©
            const isPaid = posteOrders[0].paid || false;
            document.getElementById('paidCheckbox').checked = isPaid;
            
            document.getElementById('posteModal').style.display = 'flex';
        }

        function closePosteModal() {
            document.getElementById('posteModal').style.display = 'none';
            currentModalPoste = null;
        }

        function togglePaid() {
            if (!currentModalPoste) return;
            
            const isPaid = document.getElementById('paidCheckbox').checked;
            
            // Mettre √† jour toutes les commandes de ce poste
            APP.allOrders.forEach(order => {
                if (order.type === currentModalPoste.type && order.poste === currentModalPoste.posteNum) {
                    order.paid = isPaid;
                }
            });
            
            saveOrders();
            showTotalType(currentModalPoste.type);
            
            if (isPaid) {
                showNotif('‚úÖ Commande marqu√©e comme pay√©e');
            } else {
                showNotif('‚ö†Ô∏è Commande marqu√©e comme non pay√©e', true);
            }
        }

        function renderTotal() {
            // Par d√©faut afficher les carpodromes
            showTotalType('carpodrome');
        }

        // Notification
        function showNotif(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'notif' + (isError ? ' error' : '');
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 3000);
        }

        // Panneau Admin
        // Panneau Admin
        function openAdminLogin() {
            window.adminActionType = null;
            window.deleteOrderPending = null;
            document.getElementById('adminLoginModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordInput').focus();
            }, 100);
            document.getElementById('adminError').style.display = 'none';
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            
            if (password === 'admin') {
                closeAdminLogin();
                
                // Si c'est pour supprimer une commande
                if (window.adminActionType === 'delete' && window.deleteOrderPending) {
                    executeDeleteOrder(window.deleteOrderPending);
                    window.deleteOrderPending = null;
                    window.adminActionType = null;
                } else {
                    // Sinon ouvrir le panneau admin normal
                    renderAdminPanel();
                    document.getElementById('adminModal').style.display = 'flex';
                }
            } else {
                const errorDiv = document.getElementById('adminError');
                errorDiv.textContent = '‚ùå Code incorrect ! R√©essayez.';
                errorDiv.style.display = 'block';
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordInput').focus();
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function renderAdminPanel() {
            const content = document.getElementById('adminContent');
            content.innerHTML = '';
            
            const title = document.createElement('h3');
            title.textContent = 'üìù Gestion des Produits et Tarifs';
            title.style.cssText = 'margin-bottom: 20px; color: #0ea5e9;';
            content.appendChild(title);
            
            const productsDiv = document.createElement('div');
            productsDiv.style.cssText = 'display: grid; gap: 15px;';
            
            DATA.products.forEach((product, idx) => {
                const row = document.createElement('div');
                row.style.cssText = 'display: grid; grid-template-columns: 2fr 80px 120px 50px; gap: 10px; align-items: center; padding: 12px; background: #1e293b; border-radius: 8px; border: 2px solid #334155;';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.id = 'prod-name-' + idx;
                nameInput.value = product.name;
                nameInput.style.cssText = 'padding: 10px; background: #0a0f1e; border: 2px solid #334155; border-radius: 6px; color: white; font-size: 0.95rem; font-family: Inter, sans-serif;';
                
                const priceInput = document.createElement('input');
                priceInput.type = 'number';
                priceInput.id = 'prod-price-' + idx;
                priceInput.value = product.price;
                priceInput.step = '0.5';
                priceInput.style.cssText = 'padding: 10px; background: #0a0f1e; border: 2px solid #334155; border-radius: 6px; color: white; font-size: 0.95rem; font-family: Inter, sans-serif;';
                
                const catSelect = document.createElement('select');
                catSelect.id = 'prod-cat-' + idx;
                catSelect.style.cssText = 'padding: 10px; background: #0a0f1e; border: 2px solid #334155; border-radius: 6px; color: white; font-size: 0.9rem; font-family: Inter, sans-serif;';
                catSelect.innerHTML = `
                    <option value="drink" ${product.category === 'drink' ? 'selected' : ''}>ü•§</option>
                    <option value="sandwich" ${product.category === 'sandwich' ? 'selected' : ''}>ü•™</option>
                    <option value="side" ${product.category === 'side' ? 'selected' : ''}>üçü</option>
                `;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.style.cssText = 'padding: 10px; background: #ef4444; border: none; border-radius: 6px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;';
                deleteBtn.setAttribute('data-idx', idx);
                deleteBtn.setAttribute('data-name', product.name);
                deleteBtn.onclick = function() {
                    const btnIdx = parseInt(this.getAttribute('data-idx'));
                    const btnName = this.getAttribute('data-name');
                    console.log('DELETE PRODUCT CLICKED! idx:', btnIdx, 'product:', btnName);
                    
                    // ACTION DIRECTE sans confirm
                    DATA.products.splice(btnIdx, 1);
                    console.log('Produit supprim√©, il reste:', DATA.products.length, 'produits');
                    renderAdminPanel();
                    showNotif('üóëÔ∏è Produit supprim√© (pensez √† sauvegarder)');
                };
                
                row.appendChild(nameInput);
                row.appendChild(priceInput);
                row.appendChild(catSelect);
                row.appendChild(deleteBtn);
                productsDiv.appendChild(row);
            });
            
            content.appendChild(productsDiv);
            
            const addBtn = document.createElement('button');
            addBtn.textContent = '‚ûï Ajouter un produit';
            addBtn.style.cssText = 'width: 100%; margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #0ea5e9, #0284c7); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem;';
            addBtn.onclick = addNewProduct;
            content.appendChild(addBtn);
            
            const saveBtn = document.createElement('button');
            saveBtn.textContent = 'üíæ Enregistrer les modifications';
            saveBtn.style.cssText = 'width: 100%; margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem;';
            saveBtn.onclick = saveAdminChanges;
            content.appendChild(saveBtn);
            
            const clearBtn = document.createElement('button');
            clearBtn.textContent = 'üóëÔ∏è Effacer toutes les commandes';
            clearBtn.style.cssText = 'width: 100%; margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #ef4444, #dc2626); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; font-size: 1.1rem;';
            clearBtn.onclick = clearAllOrders;
            content.appendChild(clearBtn);
        }

        function addNewProduct() {
            DATA.products.push({
                name: 'Nouveau produit',
                price: 2.0,
                category: 'drink',
                sauces: null
            });
            renderAdminPanel();
            showNotif('‚ûï Produit ajout√©');
        }

        function saveAdminChanges() {
            DATA.products = DATA.products.map((product, idx) => ({
                name: document.getElementById(`prod-name-${idx}`).value,
                price: parseFloat(document.getElementById(`prod-price-${idx}`).value),
                category: document.getElementById(`prod-cat-${idx}`).value,
                sauces: product.sauces // Conserver les infos sauces
            }));
            
            // Sauvegarder sur Firebase
            database.ref('products').set(DATA.products)
                .then(() => {
                    console.log('üíæ Produits sauvegard√©s sur Firebase');
                    showNotif('‚úÖ Produits et tarifs mis √† jour !');
                    closeAdminPanel();
                })
                .catch((error) => {
                    console.error('‚ùå Erreur Firebase:', error);
                    showNotif('‚ùå Erreur de sauvegarde !', true);
                });
        }

        function clearAllOrders() {
            console.log('EFFACER TOUTES LES COMMANDES');
            // ACTION DIRECTE - pas de confirm
            APP.allOrders = [];
            saveOrders();
            showNotif('üóëÔ∏è Toutes les commandes ont √©t√© supprim√©es');
            closeAdminPanel();
        }

        // Charger les produits personnalis√©s depuis Firebase
        function loadCustomProducts() {
            database.ref('products').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    DATA.products = data;
                    console.log('üì• Produits charg√©s depuis Firebase:', DATA.products.length, 'produits');
                }
            });
        }

        // Init
        loadCustomProducts();
        loadOrders();
    </script>
</body>
</html>
